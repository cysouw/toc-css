<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Introducing toc-css</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
   
  <!-- CSS added by filter 'toc-css.lua' for TOC hovering to the side -->
  <style>
  body {
    padding-left: 1cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  nav {
    width: 1em;
    margin-left: -1cm;
    font-size: smaller;
    color: grey;
    transition: 0.5s;
    float: left;
    position: fixed;
    top: 0;
    bottom: 0;
    white-space: nowrap; 
    overflow: hidden;
    overflow-y: scroll;
    transition: 0.5s;
  }
  nav::-webkit-scrollbar {
    display: none;
  }
  nav a, nav a:visited {
    color: grey;
  }
  nav h2:before {
    content: "≡ ";
    font-size: 150%;
  }
  nav h2:after {
    content: " ◀";
  }
  nav li {
    margin-left: -0.5em;
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis;
  }
  nav li > a:not(:only-child):before {
    content: "▶ ";
  }
  nav li > a:only-child {
    margin-left: 0.75em;
  }
  nav li li {
    margin-left: 1em;
  }
  nav li li li {
    margin-left: -0.5em;
    font-size: smaller;
  }
  nav ul li ul  {
    visibility: hidden;
    display: none;
    margin-top: 0.2em;
    margin-bottom: 0.2em;
    transition: 0.5s;
  }
  .bodysmall {
    padding-left: 9cm;
    transition: 0.5s;
  }
  .navside {
    width: 7cm;
    margin-left: -8.5cm;
    padding-right: 1cm;
    transition: 0.5s;
  }
  .navside h2:after {
    content: " ▶";
  }
  .navshown {
    width: 50%;
    transition: 0.5s;
    background-color: rgba(255, 255, 255, 0.95);
  }
  .subShow > ul {
    visibility: visible;
    display: block;
    transition: 0.5s;
    margin-left: -1em;
  }
  .subShow > a:not(:only-child):before {
    content: "▼ ";
  }
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">Introducing toc-css</h1>
</header>
<nav id="TOC" role="doc-toc">
<h2 id="toc-title">CONTENTS</h2>
<ul>
<li><a href="#introducing-toc-css"><span class="toc-section-number">1</span> Introducing toc-css</a>
<ul>
<li><a href="#pandoc"><span class="toc-section-number">1.1</span> Pandoc</a></li>
<li><a href="#usage"><span class="toc-section-number">1.2</span> Usage</a></li>
</ul></li>
<li><a href="#another-first-level-heading"><span class="toc-section-number">2</span> Another first level heading</a>
<ul>
<li><a href="#with-subheading"><span class="toc-section-number">2.1</span> With subheading</a>
<ul>
<li><a href="#going-deeper"><span class="toc-section-number">2.1.1</span> Going deeper</a></li>
<li><a href="#more"><span class="toc-section-number">2.1.2</span> More</a></li>
<li><a href="#lets-try-a-completely-long-and-superfluous-title"><span class="toc-section-number">2.1.3</span> Let’s try a completely long and superfluous title</a></li>
</ul></li>
<li><a href="#another-subheading"><span class="toc-section-number">2.2</span> Another subheading</a>
<ul>
<li><a href="#example-1"><span class="toc-section-number">2.2.1</span> Example 1</a></li>
<li><a href="#example-2"><span class="toc-section-number">2.2.2</span> Example 2</a></li>
<li><a href="#example-3"><span class="toc-section-number">2.2.3</span> Example 3</a></li>
</ul></li>
</ul></li>
<li><a href="#next-chapter"><span class="toc-section-number">3</span> Next Chapter</a>
<ul>
<li><a href="#next-subheading"><span class="toc-section-number">3.1</span> Next Subheading</a></li>
<li><a href="#another-very-long-title-that-will-not-fit"><span class="toc-section-number">3.2</span> Another very long title that will not fit</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="introducing-toc-css"><span class="header-section-number">1</span> Introducing toc-css</h1>
<p>Pandoc Lua Filter to add floating table of contents to HTML</p>
<p><strong>Michael Cysouw</strong> <a href="mailto:cysouw@mac.com" class="email">cysouw@mac.com</a></p>
<h2 data-number="1.1" id="pandoc"><span class="header-section-number">1.1</span> Pandoc</h2>
<p><a href="https://pandoc.org">Pandoc</a> is a fabulous system to prepare text and export it to (almost) every format of your liking. Pandoc includes an option to add a table of contents, but by default this is just added at the top of the document. This Lua filter adds some better layout of the table of contents for HTML documents.</p>
<p>The filter adds a bit CSS and vanilla Javascript to the HTML output as created by the Pandoc defaults. The actual html is not changed in any way. If you have not added a title for the table of contents then the title “CONTENTS” is automatically added.</p>
<p>Please note that I am not a very proficient CSS/Javascript programmer. I welcome suggestions and improvements! The current version was specifically made for a long book with a very complex structure, the current version can be found <a href="https://gitcdn.link/repo/cysouw/diathesis/main/cysouwDiathesisManuscript.html">here</a> as an example.</p>
<h2 data-number="1.2" id="usage"><span class="header-section-number">1.2</span> Usage</h2>
<ul>
<li>For this filter to work, the HTML export needs to have the options <code>--standalone</code> and <code>--toc</code> to produce the basic table of contents.</li>
<li>To add a title to the table of contents, either add the following to your metadata: <code>toc-title: MY-TITLE</code> or add the option <code>--metadat=toc-title:"MY-TITLE"</code> when producing the HTML.</li>
<li>The filter itself is added by using <code>--lua-filter toc-css.lua</code>.</li>
</ul>
<p>As an example, consider the following command to convert this <code>README.md</code> into <a href="https://gitcdn.link/repo/cysouw/toc-css/main/README.html"><code>README.html</code></a>:</p>
<pre><code>pandoc README.md \
    --to html \
    --output README.html \
    --lua-filter toc-css.lua \
    --standalone \
    --toc \
    --number-sections \
    --metadata title=&quot;Introducing toc-css&quot;</code></pre>
<p>The remaining headers in this readme are only added to showcase the result in the HTML file.</p>
<h1 data-number="2" id="another-first-level-heading"><span class="header-section-number">2</span> Another first level heading</h1>
<h2 data-number="2.1" id="with-subheading"><span class="header-section-number">2.1</span> With subheading</h2>
<h3 data-number="2.1.1" id="going-deeper"><span class="header-section-number">2.1.1</span> Going deeper</h3>
<h3 data-number="2.1.2" id="more"><span class="header-section-number">2.1.2</span> More</h3>
<h3 data-number="2.1.3" id="lets-try-a-completely-long-and-superfluous-title"><span class="header-section-number">2.1.3</span> Let’s try a completely long and superfluous title</h3>
<h2 data-number="2.2" id="another-subheading"><span class="header-section-number">2.2</span> Another subheading</h2>
<h3 data-number="2.2.1" id="example-1"><span class="header-section-number">2.2.1</span> Example 1</h3>
<h3 data-number="2.2.2" id="example-2"><span class="header-section-number">2.2.2</span> Example 2</h3>
<h3 data-number="2.2.3" id="example-3"><span class="header-section-number">2.2.3</span> Example 3</h3>
<h1 data-number="3" id="next-chapter"><span class="header-section-number">3</span> Next Chapter</h1>
<h2 data-number="3.1" id="next-subheading"><span class="header-section-number">3.1</span> Next Subheading</h2>
<h2 data-number="3.2" id="another-very-long-title-that-will-not-fit"><span class="header-section-number">3.2</span> Another very long title that will not fit</h2>

<!-- Javascript added by toc-css.lua to make TOC expandable on click -->
<script>

  const b = document.querySelector("body");
  const n = document.querySelector("nav");
  const buttonsize = 15;

  // click on "toc-title" to show TOC to the side
  document.querySelector("#toc-title").addEventListener("click", function(e) {
    if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize) {
      n.classList.toggle("navshown");
    } else {
      b.classList.toggle("bodysmall");
      n.classList.toggle("navside");
      n.classList.remove("navshown");
    };
  });

  // by default show TOC in large window
  window.onload = function() {
    if (window.innerWidth > 1000) {
      b.classList.add("bodysmall");
      n.classList.add("navside");
    };
  };

  // show/hide TOC on resize
  window.onresize = function () {
    if (window.innerWidth > 1000) {
      b.classList.add("bodysmall");
      n.classList.add("navside");
    } else {
      b.classList.remove("bodysmall");
      n.classList.remove("navside");
    };
  };

  // show/hide subsections
  function toggleSub(lis) {
    for (const li of lis) {
      li.addEventListener('click', function (e) {
        if (e.clientX < e.currentTarget.getBoundingClientRect().left + buttonsize) {
          li.classList.toggle('subShow');
          e.preventDefault();
        };
      });
    };
  };

  const allLis = document.querySelectorAll("nav li");
  toggleSub(allLis);

</script>
</body>
</html>
